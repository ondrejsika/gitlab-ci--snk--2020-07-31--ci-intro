stages:
  - build
  - report
  - test
  - deploy
  - healthcheck

build:
  stage: build
  script: echo Build!

report:
  stage: report
  script: echo Reporting failed build ...
  when: on_failure
  needs:
    - build

test:
  stage: test
  script: echo Test!
  needs:
    - build

slow load test:
  stage: test
  script: sleep 20 && echo Load Test! && false
  allow_failure: true
  only:
    - master
  needs:
    - build

integration test:
  stage: test
  script: sleep 10 && echo Integration Test!
  only:
    - merge_requests
  needs:
    - build

deploy:
  stage: deploy
  script: echo Deploy!
  when: manual
  allow_failure: false
  needs:
    - test
  only:
    - master

healthcheck:
  stage: healthcheck
  script: echo Check deploymnet!
  only:
    - master
