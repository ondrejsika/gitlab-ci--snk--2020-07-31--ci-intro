stages:
  - build
  - report
  - test
  - deploy
  - healthcheck


build foo:
  stage: build
  script: echo Build foo!

build bar:
  stage: build
  script: sleep 10 && echo Build bar!

report:
  stage: report
  script: echo Reporting failed build ...
  when: on_failure
  needs:
    - build foo
    - build bar

test foo:
  stage: test
  script: echo Test foo!
  needs:
    - build foo

test bar:
  stage: test
  script: echo Test bar!
  needs:
    - build bar

slow load test:
  stage: test
  script: sleep 20 && echo Load Test! && false
  allow_failure: true
  only:
    - master
  needs:
    - build foo
    - build bar

integration test:
  stage: test
  script: sleep 10 && echo Integration Test!
  needs:
    - build foo
    - build bar

deploy foo:
  stage: deploy
  script: echo Deploy foo!
  when: manual
  allow_failure: false
  needs:
    - test foo
  only:
    - master

deploy bar:
  stage: deploy
  script: echo Deploy bar!
  when: manual
  allow_failure: false
  needs:
    - test bar
  only:
    - master

healthcheck:
  stage: healthcheck
  script: echo Check deploymnet!
  only:
    - master
  needs:
    - deploy foo
    - deploy bar
